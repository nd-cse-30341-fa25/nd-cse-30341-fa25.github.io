<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Favicon -->
<link rel="icon" type="image/png" sizes="32x32" href="static/ico/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="static/ico/favicon-16x16.png">
<link rel="manifest" href="static/ico/site.webmanifest">
<!-- Stylesheets -->
<link rel="stylesheet" href="static/css/pnutzh4x0r.css">
<title>Project 03: Heap Management</title>
</head>
<body>
<header>
<a class="logo" href="project03.html">
    <h1>Project 03: Heap Management</h1>
</a>
<nav>
    <ul>
        <li><a href="index.html"><h4>Home</h4></a></li>
        </ul>
</nav></header>
<main>
<p>The third project is to build your own implementation of <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a> and
<a href="http://man7.org/linux/man-pages/man3/malloc.3.html">free</a>.  That is, you will need to implement a library that interacts with
the operating system to perform heap management on behalf of a user process
as demonstrated in class.</p>
<p>Working <strong>individually</strong> or in <strong>pairs</strong>, you are to create a <strong>library</strong>
that implements <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a> and <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">free</a> by <strong>noon</strong> on <strong>Tuesday, November 18,
2025</strong>.  More details about this project and your deliverables are
described below.</p>
<div class="centered">
  <img src="static/img/project03-heap-management.png" class="responsive">
</div>

<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>As demonstrated in <a href="https://github.com/nd-cse-30341-fa25/examples/blob/master/lecture14/malloc0.c">malloc0.c</a> from <a href="https://docs.google.com/presentation/d/1Qe4Z8eJzqcsG1C4fpx_wSp61m3BzGpZB-nzvvtDXQcs/edit?usp=sharing">Lecture 14</a>, writing a functional heap
management system is relatively straightforward:</p>
<blockquote>
<p>Simply grow the heap using the <a href="http://man7.org/linux/man-pages/man2/brk.2.html">sbrk</a> system call whenever the user
requests memory at run-time.</p>
</blockquote>
<p>Unfortunately, this initial version of a heap manager has some serious problems:</p>
<ol>
<li>
<p>It doesn't actually free anything, so it is quite possible (and likely)
that we would eventually run out of memory.</p>
</li>
<li>
<div class="flex-col" markdown="1">
<p>It doesn't keep track of blocks that have been allocated but are no
longer in-use (ie. <strong>free</strong>), so it will never re-use a previous
allocation.  This is both wasteful (as there is memory that we could
use, but don't), and it is slow because we are then forced to call
<a href="http://man7.org/linux/man-pages/man2/brk.2.html">sbrk</a>, which is a system call and thus incurs the overhead of <em>context
switching</em>.</p>
<p>To remedy this, we wrote <a href="https://github.com/nd-cse-30341-fa25/examples/blob/master/lecture14/malloc1.c">malloc1.c</a>, which utilizes a circular
doubly-linked <a href="https://en.wikipedia.org/wiki/Free_list">free list</a> to keep track of <strong>only</strong> the <strong>free</strong> blocks as
shown below:</p>
</div>
</li>
</ol>
<div class="centered">
  <img src="static/img/project03-circular-free-list.png" class="responsive">
</div>

<p>The <a href="https://github.com/nd-cse-30341-fa25/examples/blob/master/lecture14/malloc1.c">malloc1.c</a> shown in class has the following features:</p>
<ol>
<li>
<p>It maintains a <a href="https://en.wikipedia.org/wiki/Free_list">free list</a> of all the <strong>free</strong> blocks (previously
allocated blocks that are no longer in use).</p>
</li>
<li>
<p><a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a> will search this <a href="https://en.wikipedia.org/wiki/Free_list">free list</a> for a <strong>free</strong> block it can
re-use.  If no such block exists, it will simply fall-back to growing the
heap with <a href="http://man7.org/linux/man-pages/man2/brk.2.html">sbrk</a>.</p>
</li>
<li>
<p><a href="http://man7.org/linux/man-pages/man3/malloc.3.html">free</a> will insert released blocks to the <a href="https://en.wikipedia.org/wiki/Free_list">free list</a> to make them
available for future re-use.</p>
</li>
</ol>
<p>While this second version is better than the first heap manager, it is
still lacking important features.  For this project, you are to extend the
functionality of the <a href="https://github.com/nd-cse-30341-fa25/examples/blob/master/lecture14/malloc1.c">malloc1.c</a> allocator to incorporate the following:</p>
<ol>
<li>
<p>Ensure that all memory allocations are aligned to the nearest <a href="https://en.wikipedia.org/wiki/Word_(computer_architecture)">word size</a>.</p>
</li>
<li>
<div class="flex-col" markdown="1">
<p>Implement multiple <strong>search</strong> algorithms (<strong>First Fit</strong>, <strong>Best Fit</strong>,
and <strong>Worst Fit</strong>).</p>
<p><em>To support different strategies in the same source file, we will use
<a href="https://en.wikipedia.org/wiki/C_(programming_language)">C</a>'s <a href="https://msdn.microsoft.com/en-us/library/ew2hz0yd.aspx">#if</a> directive to select different blocks of code at compile
time.</em></p>
</div>
</li>
<li>
<p>Implement <strong>shrinking</strong> the heap when a block is released.</p>
</li>
<li>
<p>Implement <strong>splitting</strong> a block when it is re-used.</p>
</li>
<li>
<p>Implement <strong>merging</strong> a block when it is inserted into the <strong>free list</strong>.</p>
</li>
<li>
<p>Ensure that blocks in the <strong>free list</strong> are stored in sorted (ie.
<strong>ascending</strong>) order.</p>
</li>
<li>
<p>Implement the complementary <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">calloc</a> and <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">realloc</a> functions.</p>
</li>
<li>
<div class="flex-col" markdown="1">
<p>Add counters to keep track of number of operations performed by the
allocator and the amount of <a href="https://en.wikipedia.org/wiki/Fragmentation_(computing)#Internal_fragmentation">internal fragmentation</a> and <a href="https://en.wikipedia.org/wiki/Fragmentation_(computing)#External_fragmentation">external
fragmentation</a>.  When the process exits, the library should output the
following type of information (based on the counters):</p>
<div class="codehilite"><pre><span></span><code>blocks:      0
free blocks: 0
mallocs:     10
frees:       10
callocs:     0
reallocs:    0
reuses:      0
grows:       10
shrinks:     10
splits:      0
merges:      0
requested:   10240
heap size:   0
internal:    0.00
external:    0.00
</code></pre></div>

</div>
</li>
</ol>
<p>Once you have a working <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a> implementation (as verified by the
provided functional and unit tests), you are to analyze the metrics above
for the different heap management strategies.</p>
<div class="alert danger-bg">
<p><strong>Note</strong>: We will not consider thread-safety or support multiple threads at
all for this project.</p>
</div>
<div class="alert info-bg">
<h3 id="cogs-embed_icon-heap-management"><i class="icon icon-medium"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>cogs</title><path d="M15.9,18.45C17.25,18.45 18.35,17.35 18.35,16C18.35,14.65 17.25,13.55 15.9,13.55C14.54,13.55 13.45,14.65 13.45,16C13.45,17.35 14.54,18.45 15.9,18.45M21.1,16.68L22.58,17.84C22.71,17.95 22.75,18.13 22.66,18.29L21.26,20.71C21.17,20.86 21,20.92 20.83,20.86L19.09,20.16C18.73,20.44 18.33,20.67 17.91,20.85L17.64,22.7C17.62,22.87 17.47,23 17.3,23H14.5C14.32,23 14.18,22.87 14.15,22.7L13.89,20.85C13.46,20.67 13.07,20.44 12.71,20.16L10.96,20.86C10.81,20.92 10.62,20.86 10.54,20.71L9.14,18.29C9.05,18.13 9.09,17.95 9.22,17.84L10.7,16.68L10.65,16L10.7,15.31L9.22,14.16C9.09,14.05 9.05,13.86 9.14,13.71L10.54,11.29C10.62,11.13 10.81,11.07 10.96,11.13L12.71,11.84C13.07,11.56 13.46,11.32 13.89,11.15L14.15,9.29C14.18,9.13 14.32,9 14.5,9H17.3C17.47,9 17.62,9.13 17.64,9.29L17.91,11.15C18.33,11.32 18.73,11.56 19.09,11.84L20.83,11.13C21,11.07 21.17,11.13 21.26,11.29L22.66,13.71C22.75,13.86 22.71,14.05 22.58,14.16L21.1,15.31L21.15,16L21.1,16.68M6.69,8.07C7.56,8.07 8.26,7.37 8.26,6.5C8.26,5.63 7.56,4.92 6.69,4.92A1.58,1.58 0 0,0 5.11,6.5C5.11,7.37 5.82,8.07 6.69,8.07M10.03,6.94L11,7.68C11.07,7.75 11.09,7.87 11.03,7.97L10.13,9.53C10.08,9.63 9.96,9.67 9.86,9.63L8.74,9.18L8,9.62L7.81,10.81C7.79,10.92 7.7,11 7.59,11H5.79C5.67,11 5.58,10.92 5.56,10.81L5.4,9.62L4.64,9.18L3.5,9.63C3.41,9.67 3.3,9.63 3.24,9.53L2.34,7.97C2.28,7.87 2.31,7.75 2.39,7.68L3.34,6.94L3.31,6.5L3.34,6.06L2.39,5.32C2.31,5.25 2.28,5.13 2.34,5.03L3.24,3.47C3.3,3.37 3.41,3.33 3.5,3.37L4.63,3.82L5.4,3.38L5.56,2.19C5.58,2.08 5.67,2 5.79,2H7.59C7.7,2 7.79,2.08 7.81,2.19L8,3.38L8.74,3.82L9.86,3.37C9.96,3.33 10.08,3.37 10.13,3.47L11.03,5.03C11.09,5.13 11.07,5.25 11,5.32L10.03,6.06L10.06,6.5L10.03,6.94Z" /></svg>
</i> Heap Management<a class="headerlink" href="#cogs-embed_icon-heap-management" title="Permanent link">&para;</a></h3>
<p>Implementing your own heap management library is more common than you
think.  For instance, <a href="https://www.mozilla.org/en-US/firefox/">Firefox</a> uses <a href="http://jemalloc.net/">jemalloc</a>, while <a href="https://www.gnu.org">GNU</a> uses
<a href="http://gee.cs.oswego.edu/dl/html/malloc.html">dlmalloc</a>, <a href="https://www.google.com">Google</a> provides <a href="http://goog-perftools.sourceforge.net/doc/tcmalloc.html">tcmalloc</a>, and [Microsoft] has <a href="https://github.com/microsoft/mimalloc">mimalloc</a>.
As hardware and operating systems evolve, the optimal <strong>heap management
strategies</strong> change as well, and so developers continue to advance the
state of the art.  For this project, we will focus on understanding the
basics and getting something that works (<em>good enough</em>).</p>
<p>For a reference on how to create a simple heap management library, I
recommend: <a href="http://danluu.com/malloc-tutorial/">A quick tutorial on implementing and debugging malloc, free,
calloc, and realloc</a>.  This is what I
initially used as the basis for this project (<em>many moons ago</em>).</p>
</div>
<h2 id="deliverables">Deliverables<a class="headerlink" href="#deliverables" title="Permanent link">&para;</a></h2>
<p>As noted above, you are to work <strong>individually</strong> or in <strong>pairs</strong> to
implement your heap management library.  You must use <a href="https://en.wikipedia.org/wiki/C_(programming_language)">C</a> (not <a href="https://isocpp.org/">C++</a>) as
the implementation language.  Any test scripts or auxillary tools can be
written in any reasonable scripting language.</p>
<h3 id="timeline">Timeline<a class="headerlink" href="#timeline" title="Permanent link">&para;</a></h3>
<p>Here is a timeline of events related to this project:</p>
<table class="bordered">
<thead>
<th>Date</th>
<th>Event</th>
</thead>
<tbody>
<tr class="success-bg">
<td class="text-strong">Monday, October 27</td>
<td>Project description and repository are available.</td>
</tr>
<tr class="caution-bg">
<td class="text-strong">Sunday, November 9</td>
<td>Brainstorming should be completed.</td>
</tr>
<tr class="danger-bg">
<td class="text-strong">Tuesday, November 18</td>
<td>Library must be completed.</td>
</tr>
</tbody>
</table>
<div class="alert success-bg">
<h3 id="github-embed_icon-group-project"><i class="icon icon-medium"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>github</title><path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z" /></svg>
</i> Group Project<a class="headerlink" href="#github-embed_icon-group-project" title="Permanent link">&para;</a></h3>
<p>For the final group project submission, please open a <strong>Pull Request</strong> on
your <strong>Project 03</strong> repository (for your <code>project03</code> branch to the <code>master</code>
branch) and assign it to the <strong>instructor</strong>.</p>
</div>
<h3 id="repository">Repository<a class="headerlink" href="#repository" title="Permanent link">&para;</a></h3>
<p>To start this project, you must create a <a href="https://github.com/nd-cse-30341-fa25/project03">Project 03</a> repository on <a href="https://github.com">GitHub</a>
using the following template:</p>
<blockquote>
<p><a href="https://classroom.github.com/a/UfCXfgYU">https://classroom.github.com/a/UfCXfgYU</a></p>
</blockquote>
<div class="alert warning-bg">
<p><strong>Note</strong>: Do your work in a separate <a href="https://git-scm.com/">git</a> branch that can be later merged
into the <code>master</code> branch (ie. make a <code>project03</code> branch, <strong>DO NOT COMMIT OR
MERGE TO MASTER</strong>).</p>
</div>
<h3 id="documentation">Documentation<a class="headerlink" href="#documentation" title="Permanent link">&para;</a></h3>
<p>The <a href="https://github.com/nd-cse-30341-fa25/project03">Project 03</a> repository includes a <code>README.md</code> file with the following
sections:</p>
<ol>
<li>
<p><strong>Student</strong>: This should be the names and email addresses of each group member.</p>
</li>
<li>
<p><strong>Video</strong>: This should have the link to your reflection video (described below).</p>
</li>
<li>
<p><strong>Brainstorming</strong>: This contains questions that should help you design
  and plan your approach to the project. <strong>You do not need to fill these
  out, but they are meant to be helpful</strong>.</p>
</li>
<li>
<p><strong>Errata</strong>: This should contain a description of any known errors or
deficiencies in your implementation.</p>
</li>
<li>
<p><strong>Acknowledgments</strong>: This should list anyone you collaborated with or
  received help from (including TAs, students, and AI tools).</p>
</li>
</ol>
<p>You must complete this document report as part of your project.</p>
<h3 id="source-code">Source Code<a class="headerlink" href="#source-code" title="Permanent link">&para;</a></h3>
<p>As you can see, the base <a href="https://github.com/nd-cse-30341-fa25/project03">Project 03</a> repository contains a <code>README.md</code>
file and the following folder hierarchy:</p>
<div class="codehilite"><pre><span></span><code>project03
<span class="w">    </span><span class="se">\_</span><span class="w">  </span>Makefile<span class="w">        </span><span class="c1"># This is the project Makefile</span>
<span class="w">    </span><span class="se">\_</span><span class="w">  </span>bin<span class="w">             </span><span class="c1"># This contains the binary executables and test scripts</span>
<span class="w">    </span><span class="se">\_</span><span class="w">  </span>include
<span class="w">        </span><span class="se">\_</span><span class="w">  </span>malloc<span class="w">      </span><span class="c1"># This contains the malloc library header files</span>
<span class="w">    </span><span class="se">\_</span><span class="w">  </span>lib<span class="w">             </span><span class="c1"># This contains the malloc library when built</span>
<span class="w">    </span><span class="se">\_</span><span class="w">  </span>src<span class="w">             </span><span class="c1"># This contains the malloc library source code</span>
<span class="w">    </span><span class="se">\_</span><span class="w">  </span>tests<span class="w">           </span><span class="c1"># This contains the functional and unit test code</span>
</code></pre></div>

<p>You must maintain this folder structure for your project and place files in
their appropriate place.</p>
<h4 id="compiling">Compiling<a class="headerlink" href="#compiling" title="Permanent link">&para;</a></h4>
<p>To help you get started, we have provided a <code>Makefile</code> with all the
necessary targets:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>make<span class="w">                  </span><span class="c1"># Build libraries and test applications</span>
Building<span class="w"> </span>lib/libmalloc-ff.so
Building<span class="w"> </span>lib/libmalloc-bf.so
Building<span class="w"> </span>lib/libmalloc-wf.so
Building<span class="w"> </span>bin/test_00
Building<span class="w"> </span>bin/test_01
Building<span class="w"> </span>bin/test_02
Building<span class="w"> </span>bin/test_03
Building<span class="w"> </span>bin/test_04
Building<span class="w"> </span>bin/test_05
Building<span class="w"> </span>bin/unit_block
Building<span class="w"> </span>bin/unit_freelist

$<span class="w"> </span>make<span class="w"> </span>clean<span class="w">            </span><span class="c1"># Removes all targets</span>
Removing<span class="w"> </span>libraries
Removing<span class="w"> </span>tests
</code></pre></div>

<div class="alert warning-bg">
<h3 id="code-tags-embed_icon-kiss"><i class="icon icon-medium"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>code-tags</title><path d="M14.6,16.6L19.2,12L14.6,7.4L16,6L22,12L16,18L14.6,16.6M9.4,16.6L4.8,12L9.4,7.4L8,6L2,12L8,18L9.4,16.6Z" /></svg>
</i> K.I.S.S.<a class="headerlink" href="#code-tags-embed_icon-kiss" title="Permanent link">&para;</a></h3>
<p>While the exact organization of the project code is up to you, keep in mind
that you will be graded in part on <strong>coding style</strong>, <strong>cleaniness</strong>, and
<strong>organization</strong>.  This means your code should be consistently formatted,
not contain any dead code, have reasonable comments, and appropriate naming
among other things:</p>
<ul>
<li>
<p>Break long functions into smaller functions.</p>
</li>
<li>
<p>Make sure each function does one thing and does it well.</p>
</li>
<li>
<p>Abstract, but don't over do it.</p>
</li>
</ul>
<p>Please refer to these <a href="static/img/coding-style.png">Coding Style</a> slides for some tips and guidelines on
coding style expectations.</p>
</div>
<h4 id="running">Running<a class="headerlink" href="#running" title="Permanent link">&para;</a></h4>
<p>Once you have the library, you can use it to override the existing <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a>
functions from the standard library by using the <code>LD_PRELOAD</code> trick:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Use our implementation of library</span>
$<span class="w"> </span>env<span class="w"> </span><span class="nv">LD_PRELOAD</span><span class="o">=</span>lib/libmalloc-ff.so<span class="w"> </span>cat<span class="w"> </span>README.md
</code></pre></div>

<p>This will load our library first and thus link any calls to <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a> and
<a href="http://man7.org/linux/man-pages/man3/malloc.3.html">free</a> in <code>cat</code> to our library rather than the standard <a href="https://en.wikipedia.org/wiki/C_(programming_language)">C</a> library.  To
make this more convenient, you should consider creating a <code>bin/run.sh</code>
script that sets the environment variable for you and then runs the
specified command.</p>
<div class="alert info-bg">
<p><strong>Note</strong>: there are three versions of our custom <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a> implementation,
where each version corresponds to a different <strong>search</strong> algorithm (<strong>first
fit (ff)</strong>, <strong>best fit (bf)</strong>, and <strong>worst fit (wf)</strong>).</p>
</div>
<h4 id="implementation">Implementation<a class="headerlink" href="#implementation" title="Permanent link">&para;</a></h4>
<p>All of the <a href="https://en.wikipedia.org/wiki/C_(programming_language)">C</a> header files are in the <code>include/malloc</code> folder, while the
<a href="https://en.wikipedia.org/wiki/C_(programming_language)">C</a> source code for the <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a> library is in the <code>src</code> folder.  To help
you get started, parts of the project are already implemented:</p>
<div class="codehilite"><pre><span></span><code><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>include/malloc/block.h<span class="w">      </span><span class="c1"># Block structure header (implemented)</span>
<span class="o">[</span>x<span class="o">]</span><span class="w"> </span>include/malloc/counters.h<span class="w">   </span><span class="c1"># Counters header (implemented)</span>
<span class="o">[</span>x<span class="o">]</span><span class="w"> </span>include/malloc/freelist.h<span class="w">   </span><span class="c1"># Free List header (implemented)</span>
<span class="o">[</span>~<span class="o">]</span><span class="w"> </span>src/block.c<span class="w">                 </span><span class="c1"># Block structure definitions (partially implemented)</span>
<span class="o">[</span>~<span class="o">]</span><span class="w"> </span>src/counters.c<span class="w">              </span><span class="c1"># Counters definitions (partially implemented)</span>
<span class="o">[</span>~<span class="o">]</span><span class="w"> </span>src/freelist.c<span class="w">              </span><span class="c1"># Free List definitions (partially implemented)</span>
<span class="o">[</span>~<span class="o">]</span><span class="w"> </span>src/posix.c<span class="w">                 </span><span class="c1"># POSIX definitions (partially implemented)</span>
</code></pre></div>

<p>Basically, the <a href="https://github.com/nd-cse-30341-fa25/examples/blob/master/lecture14/malloc1.c">malloc1.c</a> code demonstrated in <a href="https://docs.google.com/presentation/d/1Qe4Z8eJzqcsG1C4fpx_wSp61m3BzGpZB-nzvvtDXQcs/edit?usp=sharing">Lecture 14</a> was taken and
split into separate files to form the skeleton provided to you.
Additionally, we have implemented most of the desired counting
functionality for you, so you can concentrate on just the block
manipulation and free list management operations.  Each of the functions in
the incomplete files above have comments that describe what needs to be
done.</p>
<p>You will need to examine these source files and complete the implementation
of a <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a> library that uses a <strong>circular doubly-linked</strong> <a href="https://en.wikipedia.org/wiki/Free_list">free list</a> to
track <strong>free</strong> blocks in sorted order (ie. smaller block addresses appear
towards the front of the <a href="https://en.wikipedia.org/wiki/Free_list">free list</a>).  To do so, you should start with the
basic <code>Block</code> functions, then move to the <a href="https://en.wikipedia.org/wiki/Free_list">free list</a> functions.  Once
those pass the provided unit tests, you should then utilize those
components to complete the <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a>, <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">free</a>, <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">calloc</a>, and <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">realloc</a>
functions:</p>
<ol>
<li>
<p><code>src/block.c</code>: This file contains the functions for the <code>Block</code>
structure, which contains the <strong>aligned</strong> <code>capacity</code> of the requested
allocation and the <strong>unaligned</strong> <code>size</code> of the requested allocation
(neither of which includes space for the embedded <code>Block</code> structure), and
pointers to the previous and next <code>Block</code> structures.  If the <code>Block</code> is
detached, then it should just point to itself.</p>
<p>You will need to think carefully about how to manipulate the <code>Block</code>
structure in the context of circular doubly-linked list with a sentinel
node.</p>
</li>
<li>
<p><code>src/counters.c</code>: This file contains the functions for keeping
track of the various counters utilized in the library.  Whenever <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a>
is called, it will call the <code>init_counters</code> function which will register
the <code>dump_counters</code> function to run when the program properly terminates.</p>
<p>You will need to implement the functions for computing the <a href="https://en.wikipedia.org/wiki/Fragmentation_(computing)#Internal_fragmentation">internal
fragmentation</a> and <a href="https://en.wikipedia.org/wiki/Fragmentation_(computing)#External_fragmentation">external fragmentation</a> of the heap.</p>
</li>
<li>
<p><code>src/freelist.c</code>: This file contains the functions for the <a href="https://en.wikipedia.org/wiki/Free_list">free
list</a>.</p>
<p>You will need to think carefully about what needs to happen during
searching and insertion.  In particular, you will need to think about
how to ensure the <a href="https://en.wikipedia.org/wiki/Free_list">free list</a> remains in sorted order and then how to
exploit that ordering to <strong>merge</strong> adjacent blocks.</p>
</li>
<li>
<p><code>src/posix.c</code>: This file contains the <a href="https://en.wikipedia.org/wiki/POSIX">POSIX</a> functions: <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a>,
<a href="http://man7.org/linux/man-pages/man3/malloc.3.html">free</a>, <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">calloc</a>, <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">realloc</a>.</p>
<p>You will need to think carefully about which of the previous functions
you want to utilize.</p>
</li>
</ol>
<div class="alert info-bg">
<p><strong>Note</strong>: There are also some <code>TODOs</code> to help identify which parts you need
to implement, along with how you will want to modify the counters.</p>
</div>
<div class="alert success-bg">
<h3 id="format-align-right-embed_icon-alignment"><i class="icon icon-medium"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>format-align-right</title><path d="M3,3H21V5H3V3M9,7H21V9H9V7M3,11H21V13H3V11M9,15H21V17H9V15M3,19H21V21H3V19Z" /></svg>
</i> Alignment<a class="headerlink" href="#format-align-right-embed_icon-alignment" title="Permanent link">&para;</a></h3>
<p>For better performance, all memory allocations should be aligned by the
<a href="https://en.wikipedia.org/wiki/Word_(computer_architecture)">word size</a> of the current machine.  For instance, if the user requests
<code>14</code> bytes and our <a href="https://en.wikipedia.org/wiki/Word_(computer_architecture)">word size</a> is <code>8</code> bytes, then we will actually allocate
<code>16</code> bytes as this is the nearest multiple of the <a href="https://en.wikipedia.org/wiki/Word_(computer_architecture)">word size</a> (that has
sufficient capacity).</p>
<p>A <code>ALIGN</code> macro is provided to you that will perform this <em>rounding</em>
automatically for you.  Whenever you are comparing or determining
<strong>sizes</strong>, you need to think carefully if you want to use the original size
as requested by the user and stored in the <code>Block</code> structure (e.g. <code>14</code>) or
if you really want to use the capacity of the Block (e.g.
<code>block-&gt;capacity</code>) which stores the original <strong>aligned</strong> allocation
capacity.</p>
<p>Failure to properly utilize this <code>ALIGN</code> macro will most likely lead to
<strong>subtle</strong> and <strong>frustrating</strong> errors.</p>
</div>
<h3 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h3>
<p>As you develop your library, you should utilize the provided functional and
unit tests that ensure your heap management library works correctly:</p>
<div class="codehilite"><pre><span></span><code>$ make test             # Build and runs test programs
Building bin/test_00
Building bin/test_01
Building bin/test_02
Building bin/test_03
Building bin/test_04
Building bin/test_05
Building bin/unit_block
Building bin/unit_freelist

Testing unit_block...
  block_allocate                         ... Success
  block_release                          ... Success
  block_detach                           ... Success
  block_merge                            ... Success
  block_split                            ... Success

Testing unit_freelist...
  free_list_search_ff                    ... Success
  free_list_search_bf                    ... Success
  free_list_search_wf                    ... Success
  free_list_insert                       ... Success
  free_list_length                       ... Success

Building lib/libmalloc-ff.so
Building lib/libmalloc-bf.so
Building lib/libmalloc-wf.so
Running run_test_00.sh
  Testing libmalloc-ff.so                ... Success
  Testing libmalloc-bf.so                ... Success
  Testing libmalloc-wf.so                ... Success

Running run_test_01.sh
  Testing libmalloc-ff.so                ... Success
  Testing libmalloc-bf.so                ... Success
  Testing libmalloc-wf.so                ... Success

Running run_test_02.sh
  Testing libmalloc-ff.so                ... Success
  Testing libmalloc-bf.so                ... Success
  Testing libmalloc-wf.so                ... Success

Running run_test_03.sh
  Testing libmalloc-ff.so                ... Success
  Testing libmalloc-bf.so                ... Success
  Testing libmalloc-wf.so                ... Success

Running run_test_04.sh
  Testing libmalloc-ff.so                ... Success
  Testing libmalloc-bf.so                ... Success
  Testing libmalloc-wf.so                ... Success

Running run_test_05.sh
  Timing libmalloc-ff.so                 ... 0m1.636s
  Timing libmalloc-bf.so                 ... 0m2.959s
  Timing libmalloc-wf.so                 ... 0m2.976s

Running run_test_06.sh
  Testing libmalloc-ff.so (cat)          ... Success
  Testing libmalloc-bf.so (cat)          ... Success
  Testing libmalloc-wf.so (cat)          ... Success
  Testing libmalloc-ff.so (md5sum)       ... Success
  Testing libmalloc-bf.so (md5sum)       ... Success
  Testing libmalloc-wf.so (md5sum)       ... Success
  Testing libmalloc-ff.so (sha1sum)      ... Success
  Testing libmalloc-bf.so (sha1sum)      ... Success
  Testing libmalloc-wf.so (sha1sum)      ... Success
  Testing libmalloc-ff.so (sort)         ... Success
  Testing libmalloc-bf.so (sort)         ... Success
  Testing libmalloc-wf.so (sort)         ... Success
  Testing libmalloc-ff.so (dd)           ... Success
  Testing libmalloc-bf.so (dd)           ... Success
  Testing libmalloc-wf.so (dd)           ... Success
  Testing libmalloc-ff.so (du)           ... Success
  Testing libmalloc-bf.so (du)           ... Success
  Testing libmalloc-wf.so (du)           ... Success
  Testing libmalloc-ff.so (find)         ... Success
  Testing libmalloc-bf.so (find)         ... Success
  Testing libmalloc-wf.so (find)         ... Success
  Testing libmalloc-ff.so (ls)           ... Success
  Testing libmalloc-bf.so (ls)           ... Success
  Testing libmalloc-wf.so (ls)           ... Success
</code></pre></div>

<p>Note, you can run tests individually:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>./bin/run_test_00.sh
<span class="w">  </span>Testing<span class="w"> </span>libmalloc-ff.so<span class="w">                </span>...<span class="w"> </span>Success
<span class="w">  </span>Testing<span class="w"> </span>libmalloc-bf.so<span class="w">                </span>...<span class="w"> </span>Success
<span class="w">  </span>Testing<span class="w"> </span>libmalloc-wf.so<span class="w">                </span>...<span class="w"> </span>Success
</code></pre></div>

<h3 id="debugging">Debugging<a class="headerlink" href="#debugging" title="Permanent link">&para;</a></h3>
<p>While running the tests, you may encounter some <strong>segfaults</strong> and other
memory errors.  Because we are side-loading our own <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a>
implementation, you will need to do the following to debug a test
application using <a href="https://www.gnu.org/software/gdb/">gdb</a>.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>gdb<span class="w"> </span>./bin/test_01
...
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span>exec-wrapper<span class="w"> </span>env<span class="w"> </span><span class="nv">LD_PRELOAD</span><span class="o">=</span>./lib/libmalloc-ff.so
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>run
...
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>bt
</code></pre></div>

<p>Basically, you want to first load <a href="https://www.gnu.org/software/gdb/">gdb</a> with the test program that is
crashing.  Next, you need to tell <a href="https://www.gnu.org/software/gdb/">gdb</a> to utilize the appropriate <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a>
library by creating an <code>exec-wrapper</code> that loads it into memory.  Next,
simply run the program.  Once it segfaults, you can print a stack trace by
using the <code>bt</code> command.  From there, you can explore the state of your
program and see if you can determine what went wrong.</p>
<h2 id="reflection">Reflection<a class="headerlink" href="#reflection" title="Permanent link">&para;</a></h2>
<p>To reflect on the project and the concepts involved, you will need to
create a <strong>group video demonstration</strong> of your software artifact and
complete an <strong>individual quiz</strong> (<em>each member will submit their own answers
to their own private assignments repository</em>).</p>
<h3 id="video-demonstration">Video Demonstration<a class="headerlink" href="#video-demonstration" title="Permanent link">&para;</a></h3>
<p>As part of your grade, your group will need to create a video that
demonstrates and discusses the following:</p>
<ol>
<li>
<p>Your <strong>library</strong> passing the automated tests.</p>
</li>
<li>
<div class="flex-col" markdown="1">
<p>Compares and contrast the three heap management strategies by discussing:</p>
<p>a. Which heap management strategy uses the <strong>least amount of space</strong>?</p>
<p>b. Which heap management strategy was the <strong>fastest</strong>?</p>
<p>c. Which heap management strategy exhibited the <strong>least fragmentation</strong>?</p>
</div>
</li>
<li>
<p>Any <strong>errata, quirks, or unresolved issues</strong> in your project.</p>
</li>
<li>
<p>What you <strong>learned</strong> by doing this project.</p>
</li>
</ol>
<p>The video should include narration to describe what is being presented and
should cover the requirements enumerated above. It should be no longer than
<code>5</code> minutes.</p>
<p>Please upload the video to either <a href="https://youtube.com">YouTube</a> or <a href="https://drive.google.com">Google Drive</a> and provide a
link to it in your <code>README.md</code>.</p>
<h3 id="individual-quiz">Individual Quiz<a class="headerlink" href="#individual-quiz" title="Permanent link">&para;</a></h3>
<p>Once you have completed the project, answer the following <a href="static/json/project03.json">Project 03 Quiz</a>
questions <strong>individually</strong> in your own personal <code>assignments</code> repository on <a href="https://github.com">GitHub</a>:</p>
<div id="quiz-questions"></div>

<div id="quiz-responses"></div>

<script src="static/js/dredd-quiz.js"></script>
<script>
loadQuiz('static/json/project03.json');
</script>

<pre style="display: none;" id="dr-container" class="codehilite"><code id="dredd-response"></code></pre>

<p>The results of the quiz should look like the following:</p>
<div class="codehilite"><pre><span></span><code>Checking project03 quiz ...
      Q1 0.50
      Q2 0.50
      Q3 2.00
   Score 3.00 / 3.00
  Status Success
</code></pre></div>

<div class="alert info-bg">
<h3 id="github-embed_icon-individual-quiz"><i class="icon icon-medium"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>github</title><path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z" /></svg>
</i> Individual Quiz<a class="headerlink" href="#github-embed_icon-individual-quiz" title="Permanent link">&para;</a></h3>
<p>Each group member should do the quiz on their own and record their answers
in the <code>project03</code> folder in their <strong>assignments</strong> <a href="https://github.com">GitHub</a> repository.</p>
<p>Once you have committed your work and pushed it to <a href="https://github.com">GitHub</a>, remember to
create a <strong>pull request</strong> and assign it to the appropriate <strong>teaching
assistant</strong> from the <a href="reading09_tas.html">Reading 09 TA List</a>.</p>
</div>
<h2 id="grading">Grading<a class="headerlink" href="#grading" title="Permanent link">&para;</a></h2>
<p>Your project will be graded on the following metrics:</p>
<table class="bordered">
<thead>
    <th>Metric</th>
    <th>Points</th>
  </thead>
<tbody>
    <tr class="success-bg">
      <td class="flex-col">
        <strong>Source Code</strong>
        <ol>
          <li>
          <div class="flex-col">
          <b>General</b>
            <ul>
              <li>Builds and cleans without warnings or errors</li>
              <li>Manages resources such as memory and files appropriately</li>
              <li>Is consistent, readable, and organized</li>
              <li>Has regular commits and submitted on-time</li>
            </ul>
          </div>
          </li>
          <li>
          <div class="flex-col">
          <b>Block</b>
            <ul>
              <li>Implements <b>block_release</b> properly</li>
              <li>Implements <b>block_detach</b> properly</li>
              <li>Implements <b>block_merge</b> properly</li>
              <li>Implements <b>block_split</b> properly</li>
            </ul>
          </div>
          </li>
          <li>
          <div class="flex-col">
          <b>Counters</b>
            <ul>
              <li>Implements <b>internal_fragmentation</b> properly</li>
              <li>Implements <b>external_fragmentation</b> properly</li>
            </ul>
          </div>
          </li>
          <li>
          <div class="flex-col">
          <b>Free List</b>
            <ul>
              <li>Implements <b>free_list_search_ff</b> properly</li>
              <li>Implements <b>free_list_search_bf</b> properly</li>
              <li>Implements <b>free_list_search_wf</b> properly</li>
              <li>Implements <b>free_list_insert</b> properly</li>
              <li>Implements <b>free_list_length</b> properly</li>
            </ul>
          </div>
          </li>
          <li>
          <div class="flex-col">
          <b>POSIX</b>
            <ul>
              <li>Implements <b>malloc</b> properly</li>
              <li>Implements <b>free</b> properly</li>
              <li>Implements <b>calloc</b> properly</li>
              <li>Implements <b>realloc</b> properly</li>
            </ul>
          </div>
          </li>
        </ol>
      </td>
      <td class="centered">
        <div class="flex-col">
        <strong>10.00</strong>
        <p><b><i>&nbsp;1.00</i></b></p>
            <p><i>&nbsp;0.25</i></p>
            <p><i>&nbsp;0.25</i></p>
            <p><i>&nbsp;0.25</i></p>
            <p><i>&nbsp;0.25</i></p>
        <p><b><i>&nbsp;2.50</i></b>
            <p><i>&nbsp;0.25</i></p>
            <p><i>&nbsp;0.25</i></p>
            <p><i>&nbsp;1.00</i></p>
            <p><i>&nbsp;1.00</i></p>
        <p><b><i>&nbsp;0.50</i></b></p>
            <p><i>&nbsp;0.25</i></p>
            <p><i>&nbsp;0.25</i></p>
        <p><b><i>&nbsp;3.00</i></b></p>
            <p><i>&nbsp;0.50</i></p>
            <p><i>&nbsp;0.50</i></p>
            <p><i>&nbsp;0.50</i></p>
            <p><i>&nbsp;1.00</i></p>
            <p><i>&nbsp;0.50</i></p>
        <p><b><i>&nbsp;3.00</i></b></p>
            <p><i>&nbsp;1.00</i></p>
            <p><i>&nbsp;0.50</i></p>
            <p><i>&nbsp;0.50</i></p>
            <p><i>&nbsp;1.00</i></p>
        </div>
      </td>
    </tr>
     <tr class="caution-bg">
      <td class="flex-col">
      <strong>Reflection</strong>
      <ol>
        <li>
        <div class="flex-col">
        <b>Group Video Demonstration</b>
        <ul>
          <li>Exhibits reasonable audio and video quality</li>
          <li>Demonstrates <b>library</b> passing automated tests</li>
          <li>Compares and contrasts <b>heap management strategies</b></li>
          <li>Discusses errata, quirks, or unresolved issues</li>
          <li>Discusses what the group learned from the project</li>
        </ul>
        </div>
        </li>
        <li><b>Individual Quiz</b></li>
      </ol>
      </td>
      <td class="centered">
        <div class="flex-col">
        <strong>&nbsp;5.00</strong>
        <p><b><i>&nbsp;2.00</i></b></p>
          <p><i>&nbsp;0.25</i></p>
          <p><i>&nbsp;0.75</i></p>
          <p><i>&nbsp;0.50</i></p>
          <p><i>&nbsp;0.25</i></p>
          <p><i>&nbsp;0.25</i></p>
        <p><b>&nbsp;3.00</b></p>
        </div>
      </td>
    </tr>
  </tbody>
</table>
<div class="alert warning-bg">
<h3 id="git-embed_icon-commit-history"><i class="icon icon-medium"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>git</title><path d="M2.6,10.59L8.38,4.8L10.07,6.5C9.83,7.35 10.22,8.28 11,8.73V14.27C10.4,14.61 10,15.26 10,16A2,2 0 0,0 12,18A2,2 0 0,0 14,16C14,15.26 13.6,14.61 13,14.27V9.41L15.07,11.5C15,11.65 15,11.82 15,12A2,2 0 0,0 17,14A2,2 0 0,0 19,12A2,2 0 0,0 17,10C16.82,10 16.65,10 16.5,10.07L13.93,7.5C14.19,6.57 13.71,5.55 12.78,5.16C12.35,5 11.9,4.96 11.5,5.07L9.8,3.38L10.59,2.6C11.37,1.81 12.63,1.81 13.41,2.6L21.4,10.59C22.19,11.37 22.19,12.63 21.4,13.41L13.41,21.4C12.63,22.19 11.37,22.19 10.59,21.4L2.6,13.41C1.81,12.63 1.81,11.37 2.6,10.59Z" /></svg>
</i> Commit History<a class="headerlink" href="#git-embed_icon-commit-history" title="Permanent link">&para;</a></h3>
<p>To encourage you to work on the project <strong>regularly</strong> (rather than leaving
it until the last second) and to practice performing <strong>incremental
development</strong>, part of your grade will be based on whether or not you have
regular and reasonably sized commits in your <a href="https://git-scm.com/">git</a> log.</p>
<p>That is, you will <strong>lose</strong> a point if you commit everything at once near
the project deadline.</p>
</div>
</main>
<footer>
Built using <a href="https://python.org">Python</a>
and <a href="https://jinja.palletsprojects.com">Jinja</a>
with colors from <a href="https://nordtheme.com">Nord Theme</a>
and icons from <a href="https://pictogrammers.com/library/mdi/">Material Design Icons</a>.</footer>
</body>
</html>